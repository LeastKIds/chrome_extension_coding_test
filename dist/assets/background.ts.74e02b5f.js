chrome.runtime.onMessage.addListener(function(o,i,a){if(o.type==="login"){console.log("Login message received");const e=o.data.TOKEN;let t=!1;return fetch("https://api.github.com/user",{headers:{Authorization:`Bearer ${e}`}}).then(r=>r.json()).then(r=>{const s=r.login;chrome.storage.sync.set({USER:s,TOKEN:e},function(){if(chrome.runtime.lastError){t||(a({status:!1,data:{errMessage:chrome.runtime.lastError.message}}),t=!0);return}console.log("Saved user name"),t||(a({status:!0,data:{USER:s}}),t=!0)})}).catch(r=>{t||(a({status:!1,data:{errMessage:r.toString()}}),t=!0)}),!0}else if(o.type==="repo"){let e=!1;return chrome.storage.local.get("USER",t=>{if(t.USER){const r=t.USER,s=o.data.REPO;fetch(`https://api.github.com/repos/${r}/${s}`).then(n=>n.json()).then(n=>{chrome.storage.sync.set({REPO:s},function(){if(chrome.runtime.lastError){e||(a({status:!1,data:{errMessage:chrome.runtime.lastError.message}}),e=!0);return}console.log("Saved repo"),e||(a({status:!0,data:{REPO:s}}),e=!0)})})}else e||(a({status:!1,data:{errMessage:"No user data found"}}),e=!0)}),!0}});
