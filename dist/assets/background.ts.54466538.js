chrome.runtime.onMessage.addListener(function(s,c,a){if(s.type==="login"){console.log("Login message received");const t=s.data.TOKEN;let e=!1;return fetch("https://api.github.com/user",{headers:{Authorization:`Bearer ${t}`}}).then(r=>r.json()).then(r=>{const o=r.login;chrome.storage.sync.set({USER:o,TOKEN:t},function(){if(chrome.runtime.lastError){e||(a({status:!1,data:{errMessage:chrome.runtime.lastError.message}}),e=!0);return}console.log("Saved user name"),e||(a({status:!0,data:{USER:o}}),e=!0)})}).catch(r=>{e||(a({status:!1,data:{errMessage:r.toString()}}),e=!0)}),!0}else if(s.type==="repo"){let t=!1;return chrome.storage.sync.get(["USER","TOKEN"],e=>{if(e.USER){const r=e.USER,o=e.TOKEN,n=s.data.REPO;fetch(`https://api.github.com/repos/${r}/${n}`).then(i=>i.json()).then(i=>{chrome.storage.sync.set({USER:r,TOKEN:o,REPO:n},function(){if(chrome.runtime.lastError){t||(a({status:!1,data:{errMessage:chrome.runtime.lastError.message}}),t=!0);return}console.log("Saved repo"),t||(a({status:!0,data:{REPO:n}}),t=!0)})}).catch(i=>{t||(a({status:!1,data:{errMessage:i.toString()}}),t=!0)})}else t||(a({status:!1,data:{errMessage:e}}),t=!0)}),!0}});
